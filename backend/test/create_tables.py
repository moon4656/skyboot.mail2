#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„± ìŠ¤í¬ë¦½íŠ¸
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from app.database.user import engine, Base
from sqlalchemy import text

def create_tables():
    """ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤"""
    
    try:
        print("ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„± ì‹œì‘...")
        
        # ëª¨ë“  í…Œì´ë¸” ìƒì„±
        Base.metadata.create_all(bind=engine)
        
        print("âœ… ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„± ì™„ë£Œ")
        
        # ìƒì„±ëœ í…Œì´ë¸” ëª©ë¡ í™•ì¸
        with engine.connect() as conn:
            result = conn.execute(text("SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'"))
            tables = [row[0] for row in result]
            
            print(f"ğŸ“‹ ìƒì„±ëœ í…Œì´ë¸” ëª©ë¡ ({len(tables)}ê°œ):")
            for table in sorted(tables):
                print(f"  - {table}")
        
        return True
        
    except Exception as e:
        print(f"âŒ í…Œì´ë¸” ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
        return False

if __name__ == "__main__":
    success = create_tables()
    
    if success:
        print("ğŸ‰ í…Œì´ë¸” ìƒì„± ì™„ë£Œ!")
    else:
        print("âŒ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨")
        sys.exit(1)