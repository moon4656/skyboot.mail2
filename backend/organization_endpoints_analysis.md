# Organization Router 엔드포인트 분석 및 테스트 계획

## 📋 개요
이 문서는 `organization_router.py`의 모든 엔드포인트를 분석하고 `/api/v1/auth/login` 엔드포인트를 참고하여 체계적인 테스트 계획을 수립합니다.

## 🔐 Auth/Login 엔드포인트 분석 결과

### 구조 및 특징
- **경로**: `POST /api/v1/auth/login`
- **인증 방식**: 이메일/비밀번호 기반 인증
- **응답 형태**: JWT 토큰 (access_token, refresh_token)
- **로깅**: 상세한 로그인 시도 기록 (성공/실패)
- **보안**: 클라이언트 IP, User-Agent 추적
- **에러 처리**: HTTPException 기반 표준화된 에러 응답

### 응답 스키마
```json
{
  "access_token": "string",
  "refresh_token": "string", 
  "token_type": "bearer",
  "expires_in": 1800
}
```

## 🏢 Organization Router 엔드포인트 분석

### 1. POST `/` - 조직 생성
- **목적**: 새로운 조직 생성 및 관리자 계정 설정
- **인증**: 불필요 (공개 엔드포인트)
- **요청 스키마**: `OrganizationCreateRequest`
- **응답 스키마**: `OrganizationResponse`
- **상태 코드**: 201 Created
- **주요 기능**:
  - 조직 정보 생성 (name, org_code, subdomain)
  - 관리자 계정 자동 생성
  - 상세 로깅 및 에러 처리

### 2. GET `/list` - 조직 목록 조회
- **목적**: 시스템 관리자용 조직 목록 조회
- **인증**: 시스템 관리자 권한 필요 (`get_current_admin_user`)
- **응답 스키마**: `OrganizationListResponse`
- **쿼리 파라미터**:
  - `page`: 페이지 번호 (기본값: 1)
  - `limit`: 페이지당 항목 수 (기본값: 20, 최대: 100)
  - `search`: 검색어 (조직명, 도메인)
  - `is_active`: 활성 상태 필터
- **성능 최적화**: 페이지네이션, 조건부 전체 개수 계산

### 3. GET `/current` - 현재 조직 정보 조회
- **목적**: 현재 사용자가 속한 조직 정보 조회
- **인증**: 일반 사용자 권한 (`get_current_user`)
- **응답 스키마**: `OrganizationResponse`
- **컨텍스트**: `get_current_org_id_from_context` 사용

### 4. GET `/{org_id}` - 특정 조직 정보 조회
- **목적**: 특정 조직의 상세 정보 조회
- **인증**: 일반 사용자 권한 + 권한 검증
- **경로 파라미터**: `org_id` (정규식 검증: `^[A-Za-z0-9_-]+$`)
- **권한 제어**: 
  - 일반 사용자: 자신의 조직만 조회 가능
  - 시스템 관리자: 모든 조직 조회 가능

### 5. PUT `/{org_id}` - 조직 정보 수정
- **목적**: 조직 정보 업데이트
- **인증**: 조직 관리자 또는 시스템 관리자 권한
- **요청 스키마**: `OrganizationUpdate`
- **응답 스키마**: `OrganizationResponse`
- **권한 제어**: 조직 관리자 또는 시스템 관리자만 수정 가능

### 6. DELETE `/{org_id}` - 조직 삭제
- **목적**: 조직 삭제 (소프트/하드 삭제 지원)
- **인증**: 시스템 관리자 권한 필요
- **쿼리 파라미터**: `force` (하드 삭제 여부)
- **상태 코드**: 204 No Content
- **주의사항**: 강제 삭제 시 모든 관련 데이터 영구 삭제

### 7. GET `/{org_id}/stats` - 조직 통계 조회
- **목적**: 조직의 사용량 및 통계 정보 조회
- **인증**: 조직 관리자 또는 시스템 관리자 권한
- **응답 스키마**: `OrganizationStatsResponse`
- **통계 정보**: 사용자 수, 저장 공간 사용량, 메일 통계 등

### 8. GET `/current/stats` - 현재 조직 통계 조회
- **목적**: 현재 사용자가 속한 조직의 통계 정보 조회
- **인증**: 일반 사용자 권한
- **응답 스키마**: `OrganizationStatsResponse`

### 9. GET `/{org_id}/settings` - 조직 설정 조회
- **목적**: 조직의 설정 정보 조회
- **인증**: 조직 관리자 또는 시스템 관리자 권한
- **응답 스키마**: `OrganizationSettingsResponse`
- **설정 정보**: 메일 설정, 보안 설정 등

### 10. PUT `/{org_id}/settings` - 조직 설정 수정
- **목적**: 조직의 설정 정보 수정
- **인증**: 조직 관리자 또는 시스템 관리자 권한
- **요청 스키마**: `OrganizationSettingsUpdate`
- **응답 스키마**: `OrganizationSettingsResponse`

## 🎯 테스트 계획 및 체크포인트

### Phase 1: 환경 설정 및 기본 데이터 준비
- [ ] 테스트 환경 확인 (서버 실행 상태)
- [ ] 테스트용 조직 및 사용자 데이터 준비
- [ ] 인증 토큰 획득 (다양한 권한 레벨)

### Phase 2: 공개 엔드포인트 테스트
- [ ] **POST `/`** - 조직 생성
  - [ ] 정상 케이스: 유효한 데이터로 조직 생성
  - [ ] 에러 케이스: 중복 org_code, 잘못된 데이터 형식
  - [ ] 경계값 테스트: 최대 길이, 특수 문자 처리

### Phase 3: 인증 필요 엔드포인트 테스트
- [ ] **GET `/list`** - 조직 목록 조회 (시스템 관리자)
  - [ ] 정상 케이스: 페이지네이션, 검색, 필터링
  - [ ] 권한 테스트: 일반 사용자 접근 차단
  - [ ] 성능 테스트: 대량 데이터 처리

- [ ] **GET `/current`** - 현재 조직 정보 조회
  - [ ] 정상 케이스: 유효한 토큰으로 조직 정보 조회
  - [ ] 에러 케이스: 무효한 토큰, 조직 없음

- [ ] **GET `/{org_id}`** - 특정 조직 정보 조회
  - [ ] 정상 케이스: 자신의 조직 조회
  - [ ] 권한 테스트: 다른 조직 접근 차단
  - [ ] 시스템 관리자: 모든 조직 접근 가능

### Phase 4: 관리 기능 테스트
- [ ] **PUT `/{org_id}`** - 조직 정보 수정
  - [ ] 정상 케이스: 유효한 데이터로 수정
  - [ ] 권한 테스트: 권한 없는 사용자 차단
  - [ ] 데이터 검증: 잘못된 형식 처리

- [ ] **DELETE `/{org_id}`** - 조직 삭제
  - [ ] 소프트 삭제 테스트
  - [ ] 하드 삭제 테스트 (force=true)
  - [ ] 권한 테스트: 시스템 관리자만 접근

### Phase 5: 통계 및 설정 테스트
- [ ] **GET `/{org_id}/stats`** - 조직 통계 조회
- [ ] **GET `/current/stats`** - 현재 조직 통계 조회
- [ ] **GET `/{org_id}/settings`** - 조직 설정 조회
- [ ] **PUT `/{org_id}/settings`** - 조직 설정 수정

### Phase 6: 통합 테스트 및 에러 시나리오
- [ ] 동시성 테스트: 여러 사용자 동시 접근
- [ ] 데이터 일관성 테스트
- [ ] 네트워크 오류 시나리오
- [ ] 대용량 데이터 처리 테스트

## 📊 테스트 결과 기록 형식

각 테스트 실행 후 다음 정보를 기록:

```json
{
  "endpoint": "POST /api/v1/organizations/",
  "test_case": "정상_조직_생성",
  "timestamp": "2024-12-XX 00:00:00",
  "status": "PASS/FAIL",
  "response_time": "123ms",
  "status_code": 201,
  "request_data": {...},
  "response_data": {...},
  "errors": [],
  "notes": "추가 메모"
}
```

## 🔧 테스트 도구 및 환경

- **테스트 도구**: PowerShell Invoke-RestMethod
- **서버**: http://localhost:8000
- **로깅**: 상세 요청/응답 로그 기록
- **인증**: JWT 토큰 기반
- **데이터베이스**: PostgreSQL (테스트 데이터 확인)

## 📝 주의사항

1. **권한 테스트**: 각 엔드포인트의 권한 요구사항 엄격히 테스트
2. **데이터 검증**: 입력 데이터 형식 및 제약 조건 확인
3. **에러 처리**: 예상되는 모든 에러 시나리오 테스트
4. **성능**: 응답 시간 및 대용량 데이터 처리 능력 확인
5. **보안**: 인증 우회 시도 및 권한 상승 공격 테스트