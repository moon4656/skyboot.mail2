#!/usr/bin/env python3
"""
ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
"""

import os
import sys
from sqlalchemy import create_engine, text
from app.config import settings

def reset_database():
    """ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤."""
    
    # ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
    engine = create_engine(settings.DATABASE_URL)
    
    try:
        with engine.connect() as conn:
            # ëª¨ë“  í…Œì´ë¸” ì‚­ì œ
            print("ğŸ—‘ï¸ ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ ì¤‘...")
            conn.execute(text("DROP SCHEMA public CASCADE;"))
            conn.execute(text("CREATE SCHEMA public;"))
            conn.execute(text("GRANT ALL ON SCHEMA public TO postgres;"))
            conn.execute(text("GRANT ALL ON SCHEMA public TO public;"))
            conn.commit()
            print("âœ… ê¸°ì¡´ í…Œì´ë¸” ì‚­ì œ ì™„ë£Œ")
            
        print("ğŸ”„ Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì¤‘...")
        os.system("alembic upgrade head")
        print("âœ… ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì™„ë£Œ")
        
    except Exception as e:
        print(f"âŒ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨: {e}")
        sys.exit(1)

if __name__ == "__main__":
    reset_database()