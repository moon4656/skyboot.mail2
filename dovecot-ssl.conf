# Dovecot SSL/TLS Configuration for Outlook Integration
# SkyBoot Mail Server - Outlook 호환 보안 설정

# SSL/TLS 활성화
ssl = required
ssl_cert = </etc/ssl/certs/dovecot.pem
ssl_key = </etc/ssl/private/dovecot.pem

# SSL 프로토콜 및 암호화 설정
ssl_protocols = !SSLv2 !SSLv3 TLSv1.2 TLSv1.3
ssl_cipher_list = ECDHE+AESGCM:ECDHE+CHACHA20:DHE+AESGCM:DHE+CHACHA20:!aNULL:!MD5:!DSS
ssl_prefer_server_ciphers = yes

# IMAPS (포트 993) 설정
service imap-login {
  inet_listener imap {
    port = 143
    ssl = no
  }
  inet_listener imaps {
    port = 993
    ssl = yes
  }
}

# POP3S (포트 995) 설정
service pop3-login {
  inet_listener pop3 {
    port = 110
    ssl = no
  }
  inet_listener pop3s {
    port = 995
    ssl = yes
  }
}

# Outlook 호환성을 위한 추가 설정
protocol imap {
  # Outlook에서 필요한 IMAP 확장 기능
  imap_capability = +IDLE +QUOTA +QUOTA=RES-STORAGE
  
  # 메일박스 목록 최적화
  imap_idle_notify_interval = 2 mins
  
  # Outlook 호환 날짜 형식
  imap_client_workarounds = delay-newmail tb-extra-mailbox-sep tb-lsub-flags
}

protocol pop3 {
  # Outlook POP3 호환성
  pop3_client_workarounds = outlook-no-nuls oe-ns-eoh
  
  # UIDL 형식 최적화
  pop3_uidl_format = %08Xu%08Xv
}

# 인증 보안 강화
auth_mechanisms = plain login cram-md5

# 연결 제한 및 보안
login_greeting = SkyBoot Mail Server ready.
login_trusted_networks = 127.0.0.1 ::1

# 로깅 강화 (Outlook 연결 문제 디버깅용)
auth_verbose = yes
auth_verbose_passwords = no
auth_debug = no
auth_debug_passwords = no
mail_debug = no
verbose_ssl = no