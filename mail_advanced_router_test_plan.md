# Mail Advanced Router 테스트 계획서

## 📋 개요
SkyBoot Mail SaaS 시스템의 `mail_advanced_router.py` 고급 메일 기능에 대한 종합적인 테스트 계획입니다.

## 🎯 테스트 대상 API 엔드포인트

### 1. 폴더 관리 기능 (Folder Management)

#### 1.1 GET /api/v1/mail/folders - 폴더 목록 조회
- **기능**: 사용자의 모든 폴더 조회 (조직별 분리)
- **테스트 시나리오**:
  - ✅ 정상적인 폴더 목록 조회
  - ✅ 빈 폴더 목록 조회
  - ✅ 조직별 폴더 분리 확인
  - ❌ 인증되지 않은 사용자 접근
  - ❌ 다른 조직 폴더 접근 시도
- **예상 결과**: 
  - 성공: 200, 폴더 목록과 각 폴더의 메일 개수 반환
  - 실패: 401 (인증 오류), 404 (메일 사용자 없음)
- **테스트 데이터**: 기본 시스템 폴더 + 사용자 정의 폴더

#### 1.2 POST /api/v1/mail/folders - 폴더 생성
- **기능**: 새로운 사용자 정의 폴더 생성
- **테스트 시나리오**:
  - ✅ 정상적인 폴더 생성
  - ✅ 다양한 폴더 타입 생성 (custom)
  - ❌ 중복된 폴더명 생성 시도
  - ❌ 빈 폴더명 또는 잘못된 데이터
  - ❌ 시스템 폴더명과 동일한 이름 사용
- **예상 결과**:
  - 성공: 201, 생성된 폴더 정보 반환
  - 실패: 400 (중복/잘못된 데이터), 401 (인증 오류)
- **테스트 데이터**: 
  ```json
  {
    "name": "프로젝트 메일",
    "folder_type": "custom"
  }
  ```

#### 1.3 PUT /api/v1/mail/folders/{folder_uuid} - 폴더 수정
- **기능**: 기존 폴더 정보 수정
- **테스트 시나리오**:
  - ✅ 정상적인 폴더명 변경
  - ❌ 시스템 폴더 수정 시도 (inbox, sent, drafts, trash)
  - ❌ 존재하지 않는 폴더 수정
  - ❌ 다른 사용자의 폴더 수정 시도
  - ❌ 중복된 폴더명으로 변경
- **예상 결과**:
  - 성공: 200, 수정된 폴더 정보 반환
  - 실패: 400 (시스템 폴더/중복명), 404 (폴더 없음), 403 (권한 없음)

#### 1.4 DELETE /api/v1/mail/folders/{folder_uuid} - 폴더 삭제
- **기능**: 사용자 정의 폴더 삭제
- **테스트 시나리오**:
  - ✅ 빈 폴더 삭제
  - ✅ 메일이 있는 폴더 삭제 (메일은 받은메일함으로 이동)
  - ❌ 시스템 폴더 삭제 시도
  - ❌ 존재하지 않는 폴더 삭제
  - ❌ 다른 사용자의 폴더 삭제 시도
- **예상 결과**:
  - 성공: 200, 삭제 완료 메시지
  - 실패: 400 (시스템 폴더), 404 (폴더 없음), 403 (권한 없음)

#### 1.5 POST /api/v1/mail/folders/{folder_uuid}/mails/{mail_uuid} - 메일 폴더 이동
- **기능**: 메일을 특정 폴더로 이동
- **테스트 시나리오**:
  - ✅ 받은메일함에서 사용자 폴더로 이동
  - ✅ 사용자 폴더 간 이동
  - ✅ 휴지통에서 복원 (받은메일함으로 이동)
  - ❌ 존재하지 않는 메일 이동
  - ❌ 존재하지 않는 폴더로 이동
  - ❌ 다른 사용자의 메일/폴더 접근
- **예상 결과**:
  - 성공: 200, 이동 완료 메시지
  - 실패: 404 (메일/폴더 없음), 403 (권한 없음)

### 2. 백업/복원 기능 (Backup & Restore)

#### 2.1 POST /api/v1/mail/backup - 메일 백업
- **기능**: 사용자 메일 데이터 백업 파일 생성
- **테스트 시나리오**:
  - ✅ 전체 메일 백업 (첨부파일 포함)
  - ✅ 전체 메일 백업 (첨부파일 제외)
  - ✅ 날짜 범위 지정 백업
  - ✅ 빈 메일함 백업
  - ❌ 잘못된 날짜 범위 지정
- **예상 결과**:
  - 성공: 200, 백업 파일명과 다운로드 링크 반환
  - 실패: 400 (잘못된 파라미터), 500 (백업 생성 오류)
- **테스트 데이터**:
  ```json
  {
    "include_attachments": true,
    "date_from": "2024-01-01",
    "date_to": "2024-12-31"
  }
  ```

#### 2.2 GET /api/v1/mail/backup/{backup_filename} - 백업 파일 다운로드
- **기능**: 생성된 백업 파일 다운로드
- **테스트 시나리오**:
  - ✅ 정상적인 백업 파일 다운로드
  - ❌ 존재하지 않는 백업 파일 요청
  - ❌ 다른 사용자의 백업 파일 접근
- **예상 결과**:
  - 성공: 200, ZIP 파일 다운로드
  - 실패: 404 (파일 없음), 403 (권한 없음)

#### 2.3 POST /api/v1/mail/restore - 메일 복원
- **기능**: 백업 파일로부터 메일 데이터 복원
- **테스트 시나리오**:
  - ✅ 정상적인 백업 파일 복원
  - ✅ 중복 메일 처리 확인
  - ❌ 잘못된 형식의 백업 파일
  - ❌ 손상된 백업 파일
  - ❌ 다른 사용자의 백업 파일 복원
- **예상 결과**:
  - 성공: 200, 복원된 메일 수 반환
  - 실패: 400 (잘못된 파일), 500 (복원 오류)

### 3. 분석 기능 (Analytics)

#### 3.1 GET /api/v1/mail/analytics - 메일 분석
- **기능**: 메일 사용 패턴 및 통계 분석
- **테스트 시나리오**:
  - ✅ 일간 분석 (period=daily)
  - ✅ 주간 분석 (period=weekly)  
  - ✅ 월간 분석 (period=monthly)
  - ✅ 빈 메일함 분석
  - ❌ 잘못된 period 값
- **예상 결과**:
  - 성공: 200, 상세한 분석 데이터 반환
    - 일별 통계
    - 우선순위별 통계
    - 상위 발신자/수신자
    - 전체 요약
  - 실패: 400 (잘못된 파라미터)
- **테스트 데이터**: period=weekly, monthly, daily

## 🧪 테스트 실행 계획

### Phase 1: 기본 기능 테스트
1. **인증 및 권한 테스트**
   - 로그인 토큰 획득
   - 조직별 데이터 분리 확인
   - 권한 없는 접근 차단 확인

2. **폴더 관리 기본 CRUD 테스트**
   - 폴더 생성 → 조회 → 수정 → 삭제 순서
   - 각 단계별 데이터 무결성 확인

### Phase 2: 고급 기능 테스트
1. **메일 이동 및 폴더 관리**
   - 메일 생성 후 폴더 이동 테스트
   - 폴더 삭제 시 메일 처리 확인

2. **백업/복원 워크플로우**
   - 메일 데이터 준비 → 백업 → 삭제 → 복원 → 검증

### Phase 3: 분석 및 성능 테스트
1. **분석 기능 정확성**
   - 다양한 기간별 분석 데이터 검증
   - 통계 계산 정확성 확인

2. **대용량 데이터 처리**
   - 많은 메일이 있는 상황에서의 성능 테스트
   - 백업 파일 크기 및 처리 시간 측정

## 📊 성공 기준

### 기능적 요구사항
- ✅ 모든 API 엔드포인트가 정상 응답 (200/201)
- ✅ 조직별 데이터 분리 완벽 동작
- ✅ 권한 없는 접근 차단 (401/403)
- ✅ 잘못된 요청 적절한 오류 처리 (400/404)

### 비기능적 요구사항
- ✅ 폴더 조회 응답 시간 < 1초
- ✅ 백업 생성 시간 < 30초 (1000개 메일 기준)
- ✅ 분석 데이터 생성 시간 < 5초
- ✅ 메모리 사용량 안정성

### 데이터 무결성
- ✅ 폴더 삭제 시 메일 안전 이동
- ✅ 백업/복원 후 데이터 일치성
- ✅ 중복 메일 방지
- ✅ 조직 간 데이터 격리

## 🔧 테스트 환경 설정

### 필요한 테스트 데이터
1. **사용자 계정**: 2개 이상 (조직별 분리 테스트용)
2. **메일 데이터**: 다양한 날짜, 우선순위, 발신자의 메일 50개 이상
3. **폴더 데이터**: 시스템 폴더 + 사용자 정의 폴더
4. **첨부파일**: 다양한 크기와 형식의 파일

### 테스트 도구
- **API 테스트**: Python requests 라이브러리
- **성능 측정**: time 모듈로 응답 시간 측정
- **데이터 검증**: JSON 응답 구조 및 내용 검증
- **파일 검증**: 백업 ZIP 파일 내용 확인

## 📝 테스트 결과 기록 형식

```json
{
  "test_name": "폴더 생성 테스트",
  "endpoint": "POST /api/v1/mail/folders",
  "status": "PASS/FAIL",
  "response_time": "0.234s",
  "status_code": 201,
  "expected_result": "폴더 생성 성공",
  "actual_result": "폴더 생성 완료",
  "issues": [],
  "timestamp": "2024-12-29T10:30:00Z"
}
```

---
*테스트 계획 작성일: 2024-12-29*
*대상 시스템: SkyBoot Mail SaaS - mail_advanced_router.py*